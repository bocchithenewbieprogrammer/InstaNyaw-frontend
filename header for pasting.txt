async function loadProfile() {
  const token = localStorage.getItem("token");
  if (!token) {
    window.location.href = "../Login/index.html";
    return;
  }

  try {
    const res = await fetch("http://localhost:5000/api/profile/me", {
      headers: { Authorization: `Bearer ${token}` }
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to load profile");

    // --- Update Profile Page ---
    usernameDisplay.textContent = data.username;
    avatarDisplay.src = data.avatar || "final_icon-removebg-preview.png";
    updateBio(data.bio);

    // --- Update NAVBAR ---
    const navAvatar = document.getElementById("profileIcon");
    const navUsername = document.getElementById("navUsername");

    if (navAvatar) navAvatar.src = data.avatar || "final_icon-removebg-preview.png";
    if (navUsername) navUsername.textContent = data.username;

    // --- Role Tag (Navbar + Profile) ---
    const role = data.role || "student";
    const navRoleTag = document.getElementById("navRoleTag");
    const profileRoleTag = document.getElementById("profileRoleTag");

    if (navRoleTag) {
      navRoleTag.textContent = role.toUpperCase();
      navRoleTag.className = `nav-tag role-${role}`;
    }
    if (profileRoleTag) {
      profileRoleTag.textContent = role.toUpperCase();
      profileRoleTag.className = `nav-tag role-${role}`;
    }

    // --- Department Tag (Navbar + Profile) ---
    const dept = data.department || "";
    const navDeptTag = document.getElementById("navDeptTag");
    const profileDeptTag = document.getElementById("profileDeptTag");

    if (navDeptTag) {
      navDeptTag.textContent = dept.toUpperCase();
      navDeptTag.className = `nav-tag dept-${dept.toLowerCase()}`;
    }
    if (profileDeptTag) {
      profileDeptTag.textContent = dept.toUpperCase();
      profileDeptTag.className = `nav-tag dept-${dept.toLowerCase()}`;
    }

  } catch (err) {
    console.error(err);
    alert("Unable to load profile.");
  }
}
<!-- ===================== NAVIGATION BAR ===================== -->
<nav>
    <div class="nav-left">
        <div class="logo" onclick="window.location.href='../Homepage/Homepage.html'">
            <img src="instanyaw.png" alt="">
            <p>InstaNyaw</p>
        </div>
    </div>

    <div class="nav-center">
        <div class="search-box">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" placeholder="Search here">
        </div>
    </div>

    <div class="nav-right">

        <!-- ðŸ’¬ MESSAGE -->
        <div class="nav-item">
            <i class="fa-solid fa-message" id="msgIcon"></i>
            <div class="dropdown-bubble" id="msgDropdown">
                <p>No new message</p>
                <a id="seeAllMessagesBtn" class="see-all-msg">See all messages</a>
            </div>
        </div>

        <!-- ðŸ”” NOTIFICATION -->
        <div class="nav-item">
            <i class="fa-solid fa-bell" id="notifIcon"></i>
            <div class="dropdown-bubble" id="notifDropdown">
                <p>No new notification</p>
            </div>
        </div>

        <!-- ðŸ‘¤ PROFILE -->
        <div class="profile-menu">
            <div class="nav-user-info" id="navUserProfile">
                <span id="navUsername">User</span>

                <div class="nav-tags">
                    <span id="navRoleTag" class="nav-tag"></span>
                    <span id="navDeptTag" class="nav-tag"></span>
                </div>

                <img src="final_icon-removebg-preview.png"
                     alt="Profile"
                     class="nav-profile"
                     id="profileIcon">
            </div>

            <div class="dropdown" id="profileDropdown">
                <div class="dropdown-header" onclick="window.location.href='../Profile/profile.html'">
                    <i class="fa-solid fa-user"></i>
                    <span>View Profile</span>
                </div>
                <hr>
                <div class="dropdown-item" id="logoutBtn">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span>Logout</span>
                </div>
            </div>
        </div>
    </div>
</nav>
// ================= DROPDOWN LOGIC ==================
const profileIcon = document.getElementById("profileIcon");
const profileDropdown = document.getElementById("profileDropdown");
const msgIcon = document.getElementById("msgIcon");
const notifIcon = document.getElementById("notifIcon");
const msgDropdown = document.getElementById("msgDropdown");
const notifDropdown = document.getElementById("notifDropdown");

function closeAllDropdowns() {
    profileDropdown.classList.remove("active");
    msgDropdown.classList.remove("active");
    notifDropdown.classList.remove("active");
}

profileIcon.addEventListener("click", (e) => {
    e.stopPropagation();
    const open = profileDropdown.classList.contains("active");
    closeAllDropdowns();
    if (!open) profileDropdown.classList.add("active");
});

msgIcon.addEventListener("click", (e) => {
    e.stopPropagation();
    const open = msgDropdown.classList.contains("active");
    closeAllDropdowns();
    if (!open) msgDropdown.classList.add("active");
});

notifIcon.addEventListener("click", (e) => {
    e.stopPropagation();
    const open = notifDropdown.classList.contains("active");
    closeAllDropdowns();
    if (!open) notifDropdown.classList.add("active");
});

document.addEventListener("click", () => closeAllDropdowns());
// Update avatar + username
document.getElementById("profileIcon").src = data.avatar || "final_icon-removebg-preview.png";
document.getElementById("navUsername").textContent = data.username;

// ROLE TAG
const navRoleTag = document.getElementById("navRoleTag");
navRoleTag.textContent = data.role.toUpperCase();
navRoleTag.className = `nav-tag role-${data.role}`;

// DEPARTMENT TAG
const navDeptTag = document.getElementById("navDeptTag");
navDeptTag.textContent = data.department.toUpperCase();
navDeptTag.className = `nav-tag dept-${data.department.toLowerCase()}`;
